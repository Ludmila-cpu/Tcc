<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pagamento - Vereco</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="container payment-container">
        <div class="payment-header">
            <h2>Finalizar Pagamento</h2>
            <div class="order-total">
                <span class="total-label">Total do Pedido:</span>
                <span class="total-value">R$ 35,00</span>
            </div>
        </div>

        <div class="payment-form">
            <form id="payment-form">
                <div class="form-group">
                    <label for="card-number">Número do Cartão</label>
                    <input type="text" id="card-number" class="card-input" placeholder="1234 5678 9012 3456" required
                        pattern="[0-9]{16}" maxlength="16" />
                    <div class="card-icons">
                        <img src="src/assets/card-visa.svg" alt="Visa" />
                        <img src="src/assets/card-mastercard.svg" alt="Mastercard" />
                    </div>
                </div>

                <div class="form-group">
                    <label for="card-name">Nome no Cartão</label>
                    <input type="text" id="card-name" class="card-input" placeholder="Como está impresso no cartão"
                        required />
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="card-expiry">Validade</label>
                        <input type="text" id="card-expiry" class="card-input" placeholder="MM/AA" required
                            pattern="[0-9]{2}/[0-9]{2}" maxlength="5" />
                    </div>
                    <div class="form-group half">
                        <label for="card-cvv">CVV</label>
                        <input type="text" id="card-cvv" class="card-input" placeholder="123" required
                            pattern="[0-9]{3,4}" maxlength="4" />
                        <div class="cvv-help">?</div>
                    </div>
                </div>

                <div class="payment-actions">
                    <button type="button" class="btn-outline" onclick="window.location.href='carrinho.html'">
                        Voltar ao Carrinho
                    </button>
                    <button type="submit" class="btn-primary">
                        Finalizar Pagamento
                    </button>
                </div>
            </form>
        </div>

        <div class="payment-info">
            <div class="security-info">
                <img src="src/assets/lock.svg" alt="Segurança" class="security-icon" />
                <p>Seus dados estão seguros com criptografia SSL</p>
            </div>
        </div>
    </div>

    <script>
        // Carregar total do carrinho
        function loadCartTotal() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.querySelector('.total-value').textContent = `R$ ${total.toFixed(2)}`;
            return { cart, total };
        }

        document.getElementById('payment-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const { cart, total } = loadCartTotal();
            const cardNumber = document.getElementById('card-number').value;
            const cardName = document.getElementById('card-name').value;

            // Criar dados do pedido
            const orderData = {
                orderId: 'VRC' + Date.now(),
                date: new Date().toISOString(),
                items: cart,
                total: total,
                status: 'aprovado',
                paymentMethod: 'cartao',
                cardLastDigits: cardNumber.slice(-4),
                cardHolderName: cardName
            };

            // Salvar pedido
            localStorage.setItem('lastOrder', JSON.stringify(orderData));

            // Limpar carrinho
            localStorage.removeItem('cart');

            // Redirecionar para confirmação
            alert('Pagamento processado com sucesso! Redirecionando...');
            window.location.href = 'confirmacao.html';
        });

        // Inicializar
        loadCartTotal();

        // Formatar número do cartão
        document.getElementById('card-number').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 16) value = value.slice(0, 16);
            e.target.value = value;
        });

        // Formatar validade
        document.getElementById('card-expiry').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2);
            }
            if (value.length > 5) value = value.slice(0, 5);
            e.target.value = value;
        });

        // Formatar CVV
        document.getElementById('card-cvv').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 4) value = value.slice(0, 4);
            e.target.value = value;
        });

        // Mostrar dica do CVV
        document.querySelector('.cvv-help').addEventListener('mouseover', function () {
            alert('O CVV é o código de segurança com 3 ou 4 dígitos que está no verso do seu cartão.');
        });
    </script>
</body>

</html>