<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hist√≥rico de Pedidos - Vereco</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="site-container">
        <nav class="home-nav">
            <img src="src/assets/Imagem2.svg" alt="Vereco Logo" class="nav-logo" />
            <ul class="nav-menu" style="list-style:none; display:flex; gap:2rem; margin:0; padding:0;">
                <li><a href="index.html" class="nav-link">In√≠cio</a></li>
                <li><a href="produtos.html" class="nav-link">Produtos</a></li>
                <li><a href="historico.html" class="nav-link active">Meus Pedidos</a></li>
            </ul>
            <div class="nav-buttons">
                <button class="cart-btn" onclick="window.location.href='carrinho.html'">
                    <img src="src/assets/cart.svg" alt="Carrinho" class="cart-icon">
                    <span id="cart-count">0</span>
                </button>
            </div>
        </nav>

        <header class="page-header">
            <h1>Meus Pedidos</h1>
            <p>Hist√≥rico completo de suas compras</p>
        </header>

        <main class="history-container">
            <div id="orders-list" class="orders-list"></div>
            <div id="empty-state" class="empty-state" style="display:none;">
                <div class="empty-icon">üì¶</div>
                <h2>Nenhum pedido ainda</h2>
                <p>Voc√™ ainda n√£o fez nenhuma compra</p>
                <button class="btn-primary" onclick="window.location.href='produtos.html'">
                    Come√ßar a Comprar
                </button>
            </div>
        </main>
    </div>

    <script src="./script.js"></script>
    <script>
        function renderOrderHistory() {
            const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            const ordersList = document.getElementById('orders-list');
            const emptyState = document.getElementById('empty-state');

            if (orderHistory.length === 0) {
                ordersList.style.display = 'none';
                emptyState.style.display = 'flex';
                return;
            }

            ordersList.style.display = 'block';
            emptyState.style.display = 'none';

            ordersList.innerHTML = orderHistory.map(order => `
                <div class="order-card">
                    <div class="order-card-header">
                        <div class="order-header-left">
                            <h3>Pedido #${order.orderId}</h3>
                            <span class="order-date">${new Date(order.date).toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            })}</span>
                        </div>
                        <div class="order-header-right">
                            <span class="status-badge status-${order.status || 'aprovado'}">${order.status === 'aprovado' ? 'Aprovado' : 'Processando'}</span>
                        </div>
                    </div>

                    <div class="order-card-body">
                        <div class="order-items-summary">
                            <h4>Itens (${order.items.length})</h4>
                            ${order.items.map(item => `
                                <div class="history-item-row">
                                    <span class="item-name">${item.name}</span>
                                    <span class="item-details">
                                        <span class="item-qty">Qtd: ${item.quantity}</span>
                                        <span class="item-price">R$ ${(item.price * item.quantity).toFixed(2)}</span>
                                    </span>
                                </div>
                            `).join('')}
                        </div>

                        <div class="order-payment-info">
                            <div class="payment-row">
                                <span>M√©todo de Pagamento:</span>
                                <span>Cart√£o de Cr√©dito ${order.cardLastDigits ? `****${order.cardLastDigits}` : ''}</span>
                            </div>
                        </div>
                    </div>

                    <div class="order-card-footer">
                        <div class="order-total-display">
                            <span class="total-label">Total:</span>
                            <span class="total-value">R$ ${order.total.toFixed(2)}</span>
                        </div>
                        <button class="btn-outline-sm" onclick="viewOrderDetails('${order.orderId}')">
                            Ver Detalhes
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function viewOrderDetails(orderId) {
            const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            const order = orderHistory.find(o => o.orderId === orderId);

            if (order) {
                localStorage.setItem('lastOrder', JSON.stringify(order));
                window.location.href = 'confirmacao.html';
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function () {
            renderOrderHistory();
            updateCartCount();
        });
    </script>
</body>

</html>